import streamlit as st
import google.generativeai as genai
from PIL import Image

# --- ุฅุนุฏุงุฏ ุงูุตูุญุฉ ---
st.set_page_config(
    page_title="ูุฏูู ุฑุฎุต ุงูุจูุงุก - ุฃูุงูุฉ ุงูุฑูุงุถ",
    page_icon="๐๏ธ",
    layout="wide",
    initial_sidebar_state="expanded"
)

# --- ุงููุงุฌูุฉ ุงูุฌุงูุจูุฉ ูุฅุฏุฎุงู ุงูููุงุชูุญ ---
with st.sidebar:
    st.image("https://cdn-icons-png.flaticon.com/512/2942/2942544.png", width=100)
    st.title("ุฅุนุฏุงุฏุงุช ุงููุธุงู")
    api_key = st.text_input("ุฃุฏุฎู ููุชุงุญ Gemini API ููุง", type="password")
    st.info("ูุฐุง ุงููุธุงู ูุนูู ุจุงูุฐูุงุก ุงูุงุตุทูุงุนู ููุณุงุนุฏุฉ ุงููููุฏุณ ุงููุนูุงุฑู ูู ุชุฏููู ุงููุฎุทุทุงุช ุจูุงุกู ุนูู ุงูููุฏ ุงูุณุนูุฏู.")

# --- ุงูุนููุงู ุงูุฑุฆูุณู ---
st.title("๐๏ธ ูุธุงู ุงูุชุฏููู ุงูุขูู ูุฑุฎุต ุงูุจูุงุก - ุงูุฑูุงุถ")
st.markdown("---")

# --- ุชุนูููุงุช ุงููุธุงู ---
system_instruction = """
ุฃูุช ูููุฏุณ ูุฏูู ุฎุจูุฑ ูู ุฅุฏุงุฑุฉ ุฑุฎุต ุงูุจูุงุก ุจุฃูุงูุฉ ููุทูุฉ ุงูุฑูุงุถ.
ูุฑุฌุนู ุงููุญูุฏ ูุงูุญุตุฑู ูู ููู 'ุงูุฏููู ุงูููุญุฏ ูุงุดุชุฑุงุทุงุช ุฑุฎุต ุงูุจูุงุก'.
ูููุชู: ุนูุฏ ุฅุฑูุงู ูุฎุทุท ูุนูุงุฑู (ุตูุฑุฉ ุฃู PDF)ุ ูู ุจุชูููุฐ ุงูุชุงูู:
1. ุชุญููู ุงููุฎุทุท ูุชุญุฏูุฏ ููุนู.
2. ุงุณุชุฎุฑุงุฌ ุงููุฎุงููุงุช ุงููุงุถุญุฉ ุจูุงุก ุนูู ุงูููุฏ ุงูุนูุฑุงูู ููุฏููุฉ ุงูุฑูุงุถ.
3. ุฐูุฑ ุฃุฑูุงู ุงูุตูุญุงุช ุฃู ุงูุจููุฏ ูู ุงูุฏููู ุงูููุญุฏ ุฅู ุฃููู.
4. ูุชุงุจุฉ ุงูุชูุฑูุฑ ุจููุฌุฉ ููููุฉ ูุฑุณููุฉ.
"""

# --- ููุทู ุงูุชุทุจูู ---
if api_key:
    # ุฅุนุฏุงุฏ ุงูููุฏูู
    genai.configure(api_key=api_key)
    
    # ูุงุฌูุฉ ุฑูุน ุงูููู (ุชู ุฅุถุงูุฉ pdf ูููุงุฆูุฉ)
    uploaded_file = st.file_uploader("ูู ุจุฑูุน ุงููุฎุทุท (ุตูุฑุฉ ุฃู PDF)", type=["jpg", "jpeg", "png", "pdf"])

    if uploaded_file is not None:
        
        # ุชุฌููุฒ ุงูููู ููุฅุฑุณุงู
        model_input = None
        
        # ุฅุฐุง ูุงู ุงูููู ุตูุฑุฉุ ูุนุฑุถูุง ููุฌูุฒูุง
        if uploaded_file.type in ["image/jpeg", "image/png", "image/jpg"]:
            image = Image.open(uploaded_file)
            st.image(image, caption="ุงููุฎุทุท ุงููุฑูู", use_column_width=True)
            model_input = image
            
        # ุฅุฐุง ูุงู ุงูููู PDF
        elif uploaded_file.type == "application/pdf":
            st.success("๐ ุชู ุฑูุน ููู PDF ุจูุฌุงุญ (ุณูุชู ุชุญูููู ูุจุงุดุฑุฉ)")
            # ุชุญููู ุงูู PDF ุฅูู ุตูุบุฉ ูููููุง Gemini
            model_input = {
                "mime_type": "application/pdf",
                "data": uploaded_file.getvalue()
            }

        # ุฒุฑ ุงูุชุญููู
        if st.button("ุจุฏุก ุงูุชุฏููู ุงูุขูู ๐"):
            if model_input:
                with st.spinner('ุฌุงุฑู ุชุญููู ุงููุฎุทุท ููุทุงุจูุชู ูุน ุงูุงุดุชุฑุงุทุงุช... ูุฏ ูุณุชุบุฑู ุงูู PDF ููุชุงู ุฃุทูู ููููุงู'):
                    try:
                        # ุงุณุชุฏุนุงุก Gemini 1.5 Pro
                        model = genai.GenerativeModel('gemini-1.5-pro-latest', system_instruction=system_instruction)
                        response = model.generate_content(["ูู ุจุชุฏููู ูุฐุง ุงููุฎุทุท ูุฅุนุทุงุฆู ุชูุฑูุฑ ููุตู ุจุงูููุงุญุธุงุช ูุงููุฎุงููุงุช ุฅู ูุฌุฏุช.", model_input])
                        
                        # ุนุฑุถ ุงููุชูุฌุฉ
                        st.success("ุชู ุงูุชุฏููู ุจูุฌุงุญ!")
                        st.markdown("### ๐ ุชูุฑูุฑ ุงูุชุฏููู:")
                        st.markdown(response.text)
                        
                    except Exception as e:
                        st.error(f"ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุงููุนุงูุฌุฉ: {e}")
            else:
                st.error("ุญุฏุซ ุฎุทุฃ ูู ูุฑุงุกุฉ ุงููููุ ูุฑุฌู ุงููุญุงููุฉ ูุฑุฉ ุฃุฎุฑู.")
else:
    st.warning("ุงูุฑุฌุงุก ุฅุฏุฎุงู ููุชุงุญ API ูู ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ ููุจุฏุก.")

# --- ุชุฐููู ุงูุตูุญุฉ ---
st.markdown("---")
st.caption("ุชู ุชุทููุฑ ูุฐุง ุงููุธุงู ุจูุงุณุทุฉ ุงููุนูุงุฑู ุณูุทุงู | ูุณุฎุฉ ุชุฌุฑูุจูุฉ")
